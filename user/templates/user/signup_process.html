{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ lang }}" {% if lang == 'fa' %}dir="rtl"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Sign Up" %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/signup_process.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>
<body>

    <div class="signup-container">
        <div class="signup-header">
            <a href="#" class="back-arrow" id="signupBackArrow">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </a>
            <h1 id="signupTitle">{% trans "Sign up" %}</h1>
        </div>

        <form id="signupForm" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            <div class="signup-steps-wrapper">
                
                {% if current_step_index == 0 %}
                <!-- Step 1: User Credentials -->
                <div class="signup-step active" data-step="0">
                    <input type="hidden" name="step" value="1">
                    <div class="signup-card">
                        <div class="form-group">
                            <label for="{{ step1_form.username.id_for_label }}">{% trans "Username" %}</label>
                            {{ step1_form.username }}
                            {% if step1_form.username.errors %}<div class="error-message">{{ step1_form.username.errors.as_text }}</div>{% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ step1_form.email.id_for_label }}">{% trans "Email" %}</label>
                            {{ step1_form.email }}
                            {% if step1_form.email.errors %}<div class="error-message">{{ step1_form.email.errors.as_text }}</div>{% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ step1_form.password.id_for_label }}">{% trans "Password" %}</label>
                            <div class="password-input-container">
                                {{ step1_form.password }}
                                <span class="toggle-password" data-target="{{ step1_form.password.id_for_label }}"></span>
                            </div>
                            {% if step1_form.password.errors %}<div class="error-message">{{ step1_form.password.errors.as_text }}</div>{% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ step1_form.password2.id_for_label }}">{% trans "Confirm Password" %}</label>
                            <div class="password-input-container">
                                {{ step1_form.password2 }}
                                <span class="toggle-password" data-target="{{ step1_form.password2.id_for_label }}"></span>
                            </div>
                            {% if step1_form.password2.errors %}<div class="error-message">{{ step1_form.password2.errors.as_text }}</div>{% endif %}
                        </div>
                        {% if step1_form.non_field_errors %}<div class="error-message">{{ step1_form.non_field_errors.as_ul }}</div>{% endif %}
                        {% if step1_form.errors %}
                            <div class="error-message">
                                <ul>
                                    {% for field, errors in step1_form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        <button type="submit" class="next-step-button">{% trans "Next" %}</button>
                        <p class="login-link">{% trans "Already have an account?" %} <a href="{% url 'user:login-signup' %}">{% trans "Login" %}</a></p>
                    </div>
                </div>
                {% elif current_step_index == 1 %}
                <!-- Step 2: Profile Information -->
                <div class="signup-step active" data-step="1">
                    <input type="hidden" name="step" value="2">
                    <div class="signup-card">
                        <div class="form-group profile-picture-group">
                            <label for="{{ step2_form.profile_picture.id_for_label }}">{% trans "Profile picture" %}</label>
                            <div class="profile-picture-upload">
                                {{ step2_form.profile_picture }}
                                <label for="{{ step2_form.profile_picture.id_for_label }}" class="profile-pic-placeholder">
                                    <img src="{% static 'images/user.png' %}" alt="Profile Picture" id="profilePicPreview">
                                </label>
                            </div>
                            {% if step2_form.profile_picture.errors %}<div class="error-message">{{ step2_form.profile_picture.errors.as_text }}</div>{% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ step2_form.full_name.id_for_label }}">{% trans "Full Name" %}</label>
                            {{ step2_form.full_name }}
                            {% if step2_form.full_name.errors %}<div class="error-message">{{ step2_form.full_name.errors.as_text }}</div>{% endif %}
                        </div>
                        <div class="form-group">
                            <label>{% trans "Gender" %}</label>
                            <div class="gender-options">
                                {% for radio in step2_form.gender %}
                                    {{ radio.tag }}
                                    <label for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                                {% endfor %}
                            </div>
                            {% if step2_form.gender.errors %}<div class="error-message">{{ step2_form.gender.errors.as_text }}</div>{% endif %}
                        </div>
                        {% if step2_form.non_field_errors %}<div class="error-message">{{ step2_form.non_field_errors.as_text }}</div>{% endif %}
                        <button type="submit" class="next-step-button">{% trans "Next" %}</button>
                    </div>
                </div>
                {% elif current_step_index == 2 %}
                <!-- Step 3: Success -->
                <div class="signup-step active" data-step="2">
                    <input type="hidden" name="step" value="3">
                    <div class="signup-card">
                        <img src="{% static 'images/we2me2-logo.png' %}" alt="App Logo" class="success-logo">
                        <h2 class="success-title">{% trans "Congratulations" %}</h2>
                        <p class="success-message">{% trans "Registration has been successful" %}</p>
                        <p class="success-instruction">{% trans "Please continue to start the application" %}</p>
                        <button type="submit" class="start-app-button">{% trans "Start" %}</button>
                    </div>
                </div>
                {% endif %}
            </div>
        </form>

        <div class="signup-pagination-dots">
            <span class="dot {% if current_step_index == 0 %}active{% endif %}" data-step="0"></span>
            <span class="dot {% if current_step_index == 1 %}active{% endif %}" data-step="1"></span>
            <span class="dot {% if current_step_index == 2 %}active{% endif %}" data-step="2"></span>
        </div>
    </div>

    <script>
        const initialCurrentStep = parseInt("{{ current_step_index|default:0 }}", 10);
    </script>
    <script src="{% static 'js/signup_process.js' %}"></script>

</body>
</html>